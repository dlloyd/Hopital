<?php

namespace HOCompanyBundle\Repository;

/**
 * RepairerRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class RepairerRepository extends \Doctrine\ORM\EntityRepository
{

	public function findNbrTasks($repId){
		$qb = $this->createQueryBuilder('r');
		$qb->select('count(i)');
		$qb->innerJoin('r.interventions', 'i', 'WITH', 'i.repairer = :rep');
		$qb->where('i.isClosed = false');
		$qb->setParameter('rep',$repId);

		return $qb->getQuery()->getSingleScalarResult();

	}

	public function findAllActive(){
		$qb = $this->createQueryBuilder('r');
		$qb->select('r');
		$qb->where('r.isActive = true');

		return $qb->getQuery()->getResult();

	}
}
